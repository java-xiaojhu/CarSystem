<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<style type="text/css">
			#addH1 {
				display: inline-block;
			}
			
			#addForm {
				float: right;
				padding-top: 21px;
			}
			
			#addBottonList {
				float: right;
				margin-bottom: 20px;
			}
		</style>
	</head>

	<body>
		<div id="classMechanicApp">
			<el-row class="tac">
				<div>
					<h1 id="addH1">班组技工</h1>
					<el-form id="addForm" :inline="true" class="demo-form-inline">
						<el-form-item>
							<el-input v-model="optionName" placeholder="部门/员工编号/姓名" clearable></el-input>
						</el-form-item>
						<el-form-item>
							<el-button type="warning" @click="selectPage">搜索</el-button>
						</el-form-item>
						</mybuttonlist>
					</el-form>
				</div>
				<el-col :span="5">
					<div>
						<el-popover placement="bottom" @show="clearObj" trigger="click">
							<h1>增加车间或班组</h1>
							<el-form label-width="70px" :model="addObj">
								<el-form-item label="新增结构">
									<el-radio-group v-model="radio1" size="medium" @change="clearObj">
										<el-radio-button label="车间"></el-radio-button>
										<el-radio-button label="班组"></el-radio-button>
									</el-radio-group>
								</el-form-item>
								<div v-if="radio1=='车间'">
									<el-form-item label="车间编码">
										<el-input v-model="addObj.no" clearable></el-input>
									</el-form-item>
									<el-form-item label="车间名称">
										<el-input v-model="addObj.name" clearable></el-input>
									</el-form-item>
								</div>
								<div v-if="radio1=='班组'">
									<el-form-item label="班组编码">
										<el-input v-model="addObj.no" clearable></el-input>
									</el-form-item>
									<el-form-item label="班组名称">
										<el-input v-model="addObj.name" clearable></el-input>
									</el-form-item>
									<el-form-item label="所属车间">
										<el-select v-model="checkValue" clearable placeholder="请选择">
											<el-option v-for="item in treeData" :key="item.id" :label="item.label" :value="item.id">
											</el-option>
										</el-select>
									</el-form-item>
								</div>
								<el-form-item>
									<el-button @click="">确定</el-button>
								</el-form-item>
							</el-form>
							<el-button type="primary" slot="reference">新增</el-button>
						</el-popover>
						<el-popover placement="bottom" trigger="click">
							<h1>修改车间或班组</h1>
							<span v-if="nodeLevel==0" style="color: red;">
								请选择一个机构!
							</span>
							<el-form v-if="nodeLevel!=0" label-width="70px" :model="checkObj">
								<div v-if="nodeLevel==1">
									<el-form-item label="车间编码">
										<el-input v-model="checkObj.no" clearable></el-input>
									</el-form-item>
									<el-form-item label="车间名称">
										<el-input v-model="checkObj.name" clearable></el-input>
									</el-form-item>
								</div>
								<div v-if="nodeLevel==2">
									<el-form-item label="班组编码">
										<el-input v-model="checkObj.no" clearable></el-input>
									</el-form-item>
									<el-form-item label="班组名称">
										<el-input v-model="checkObj.name" clearable></el-input>
									</el-form-item>
								</div>
								<el-form-item>
									<el-button @click="">确定</el-button>
								</el-form-item>
							</el-form>
							<el-button type="warning" slot="reference">修改</el-button>
						</el-popover>
						<el-button type="danger" @delObj>删除</el-button>
					</div>
					<el-input placeholder="输入关键字进行过滤" clearable v-model="filterText" style="width: 90%;margin-top: 10px;">
					</el-input>
					<el-tree class="filter-tree" icon-class="el-icon-arrow-right" :data="treeData" :props="defaultProps" highlight-current accordion @node-click="handleNodeClick" :filter-node-method="filterNode" ref="tree">
					</el-tree>
				</el-col>
				<el-col :span="19">
					<div>
						<el-button type="primary" @click="addMec">新增技工</el-button>
						<el-button type="warning" @click="updateMec">修改技工</el-button>
						<el-button type="danger" @click="delMec">删除技工</el-button>
					</div>
					<mytable :tablehead="tableHead" :pagelist="pageList.list" @updateobj="updateObj">
					</mytable>
					<mypagination :pagenum="pageList.pageNum" :pagesize="pageList.pageSize" :total="pageList.total" @selectpagelist="selectPageList">
					</mypagination>
				</el-col>
			</el-row>
			<el-dialog :title="title" :visible.sync="dialogVisible" width="50%" :before-close="handleClose" center>
				<div id='load2'>这是一段信息</div>
				<!--slot="footer" class="dialog-footer" -->
			</el-dialog>
		</div>
	</body>
	<script type="text/javascript">
		var classMechanicApp = new Vue({
			data: {
				dialogVisible: false,
				title: '',
				loadUrl: '',
				optionName: '',
				filterText: '',
				mecObj: {
					a: ''
				},
				pageNum: 1,
				pageSize: 5,
				tableHead: [{
					label: '机构',
					property: 'b'
				}, {
					label: '部门代码',
					property: 'b'
				}, {
					label: '部门名称',
					property: 'c'
				}, {
					label: '工号',
					property: 'd'
				}, {
					label: '姓名',
					property: 'e'
				}, {
					label: '性别',
					property: 'f'
				}, {
					label: '岗位名称',
					property: 'g'
				}, {
					label: '身体状况',
					property: 'h'
				}, {
					label: '身高',
					property: 'i'
				}, {
					label: '籍贯',
					property: 'j'
				}],
				pageList: {
					pageNum: 1,
					pageSize: 5,
					total: 50,
					list: [{
						a: '成高',
						b: '21',
						c: '管钱部',
						d: '0EM0001',
						e: '11',
						f: '0',
						g: '前端',
						h: '良好',
						i: '1.83',
						j: '北京朝阳区'
					}, {
						a: '成高',
						b: '21',
						c: '管钱部',
						d: '0EM0001',
						e: '11',
						f: '0',
						g: '前端',
						h: '良好',
						i: '1.83',
						j: '北京朝阳区'
					}, {
						a: '成高',
						b: '21',
						c: '管钱部',
						d: '0EM0001',
						e: '11',
						f: '0',
						g: '前端',
						h: '良好',
						i: '1.83',
						j: '北京朝阳区'
					}, {
						a: '成高',
						b: '21',
						c: '管钱部',
						d: '0EM0001',
						e: '11',
						f: '0',
						g: '前端',
						h: '良好',
						i: '1.83',
						j: '北京朝阳区'
					}, {
						a: '成高',
						b: '21',
						c: '管钱部',
						d: '0EM0001',
						e: '11',
						f: '0',
						g: '前端',
						h: '良好',
						i: '1.83',
						j: '北京朝阳区'
					}]
				},
				defaultProps: {
					children: 'children',
					label: 'label'
				},
				treeData: [{
					id: 1,
					label: '自建',
					children: [{
						id: 2,
						label: '机修1组'
					}, {
						id: 3,
						label: '珠光五组'
					}]
				}, {
					id: 4,
					label: '加盟',
					children: [{
						id: 5,
						label: '华山队'
					}]
				}, {
					id: 5,
					label: '合作'
				}],
				radio1: '车间',
				addObj: {
					no: '',
					name: ''
				},
				checkObj: {
					no: '',
					name: ''
				},
				checkValue: '',
				nodeLevel: 0
			},
			watch: {
				filterText(val) {
					this.$refs.tree.filter(val);
				}
			},
			methods: {
				updateObj(obj) {
					this.mecObj = obj;
				},
				filterNode(value, data) {
					if(!value) return true;
					return data.label.indexOf(value) !== -1;
				},
				handleNodeClick(data, nodes, tree) {
					console.log("date", data);
					console.log("nodes", nodes);
					console.log("tree", tree);
					this.nodeLevel = nodes.level;
					this.$message.success('选择成功!' + JSON.stringify(data));
					alert(this.pageNum + "\t" + this.pageSize + "\t" + data.id);
				},
				selectPageList(num, size) {
					this.pageNum = num;
					this.pageSize = size;
					this.selectPage();
				},
				selectPage() {
					alert(this.pageNum + "\t" + this.pageSize + "\t" + this.optionName);
				},
				clearObj() {
					this.addObj = {};
					this.checkValue = '';
				},
				addMec() {
					if(this.nodeLevel != 2) {
						this.$message.error('请选择一个班组!');
					} else {
						this.load('新增技工', 'AddMechanic');
					}
				},
				delMec() {
					if(this.mecObj.a == '') {
						this.$message.error('请选择一名技工!');
					} else {
						this.$confirm('此操作将删除数据, 是否继续?', '提示', {
							confirmButtonText: '确定',
							cancelButtonText: '取消',
							type: 'warning'
						}).then(() => {
							this.$message.success('删除成功!');
						}).catch(() => {
							this.$message.info('已取消删除!');
						});
					}
				},
				updateMec() {
					if(this.mecObj.a == '') {
						this.$message.error('请选择一名技工!');
					} else {
						this.load('技工修改', 'UpdateMechanic');
					}
				},
				load(title, loadUrl) { //dialog对话框加载方法
					this.title = title;
					this.loadUrl = loadUrl;
					this.dialogVisible = true;
				},
				handleClose(done) {
					done();
				}
			},
			updated: function() { //v-if执行后加载页面
				$("#load2").load(this.loadUrl + '.html');
			},
			mounted() {

			}
		}).$mount("#classMechanicApp");
	</script>

</html>